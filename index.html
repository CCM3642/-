<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crispy Chicken - All in One</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background:#0d1b2a; color:#eaf1ff; font-family:Arial,sans-serif; padding:20px;}
    h1,h2 { color:#ffcc00 }
    section { border:1px solid #23315b; padding:15px; margin-bottom:20px; border-radius:8px; }
    input,select,button { padding:6px; margin:4px; border-radius:4px; border:none }
    button { background:#ff6600; color:white; cursor:pointer }
    table { border-collapse:collapse; width:100%; margin-top:10px; }
    th,td { border:1px solid #23315b; padding:8px; text-align:center }
    th { background:#1b263b }
    canvas { background:#14213d; border-radius:6px; padding:10px; }
  </style>
</head>
<body>
  <h1>üçó Crispy Chicken ‚Äì All in One System</h1>

  <!-- Branch Section -->
  <section>
    <h2>üè™ Branches</h2>
    <input id="branchName" placeholder="Branch name">
    <button onclick="addBranch()">Add Branch</button>
    <ul id="branchList"></ul>
  </section>

  <!-- Recipe Section -->
  <section>
    <h2>üìã Recipes</h2>
    <input id="recipeName" placeholder="Recipe name">
    <input id="recipeIngredients" placeholder="Ingredients (comma)">
    <button onclick="addRecipe()">Add Recipe</button>
    <ul id="recipeList"></ul>
  </section>

  <!-- Sales Section -->
  <section>
    <h2>üí∞ Sales</h2>
    <select id="saleBranch"></select>
    <select id="saleRecipe"></select>
    <input id="saleQty" type="number" placeholder="Qty" min="1">
    <button onclick="addSale()">Add Sale</button>
    <ul id="salesList"></ul>
    <button onclick="exportSales()">‚¨áÔ∏è Export Sales CSV</button>
  </section>

  <!-- Inventory Section -->
  <section>
    <h2>üì¶ Inventory</h2>
    <input id="ingName" placeholder="Ingredient">
    <input id="ingStock" type="number" placeholder="Stock" min="0">
    <button onclick="addIngredient()">Add / Update</button>
    <table><thead><tr><th>Ingredient</th><th>Stock</th></tr></thead>
    <tbody id="inventoryList"></tbody></table>
  </section>

  <!-- Reports -->
  <section>
    <h2>üìä Reports</h2>
    <h3>Daily</h3>
    <input type="date" id="dailyDate">
    <button onclick="buildDaily()">Build Daily Report</button>
    <div id="dailyKPI"></div>
    <table><thead><tr><th>Ingredient</th><th>Qty</th></tr></thead>
    <tbody id="dailyTable"></tbody></table>
    <canvas id="dailyChart" width="400" height="200"></canvas>

    <h3>Monthly</h3>
    <input type="month" id="monthlyDate">
    <button onclick="buildMonthly()">Build Monthly Report</button>
    <div id="monthlyKPI"></div>
    <table><thead id="monthlyHead"></thead><tbody id="monthlyTable"></tbody></table>
    <canvas id="monthlyChart" width="400" height="200"></canvas>
    <button onclick="exportMonthly()">‚¨áÔ∏è Export Monthly CSV</button>
  </section>

<script>
let state = JSON.parse(localStorage.getItem("crispy")) || {
  branches:[], recipes:[], sales:[], ingredients:[]
};
let dailyChart, monthlyChart;

// helpers
const qs=s=>document.querySelector(s);
function save(){ localStorage.setItem("crispy",JSON.stringify(state)); }

// Branch
function addBranch(){
  let name=qs("#branchName").value.trim();
  if(!name) return;
  state.branches.push(name); save(); renderBranches();
}
function renderBranches(){
  qs("#branchList").innerHTML=state.branches.map(b=>"<li>"+b+"</li>").join("");
  qs("#saleBranch").innerHTML=state.branches.map(b=>"<option>"+b+"</option>").join("");
}

// Recipe
function addRecipe(){
  let name=qs("#recipeName").value.trim();
  let ing=qs("#recipeIngredients").value.split(",").map(x=>x.trim()).filter(x=>x);
  if(!name||!ing.length) return;
  state.recipes.push({name,ing}); save(); renderRecipes();
}
function renderRecipes(){
  qs("#recipeList").innerHTML=state.recipes.map(r=>"<li>"+r.name+" - "+r.ing.join(",")+"</li>").join("");
  qs("#saleRecipe").innerHTML=state.recipes.map(r=>"<option>"+r.name+"</option>").join("");
}

// Ingredient
function addIngredient(){
  let name=qs("#ingName").value.trim();
  let stock=+qs("#ingStock").value;
  if(!name) return;
  let f=state.ingredients.find(i=>i===name);
  if(!f) state.ingredients.push(name);
  localStorage.setItem("crispy",JSON.stringify(state));
  renderInventory();
}
function renderInventory(){
  qs("#inventoryList").innerHTML=state.ingredients.map(i=>`<tr><td>${i}</td><td>-</td></tr>`).join("");
}

// Sales
function addSale(){
  let branch=qs("#saleBranch").value, recipe=qs("#saleRecipe").value, qty=+qs("#saleQty").value;
  if(!branch||!recipe||qty<=0) return;
  state.sales.push({branch,recipe,qty,date:new Date().toISOString().slice(0,10)});
  save(); renderSales();
}
function renderSales(){
  qs("#salesList").innerHTML=state.sales.slice(-5).map(s=>`<li>${s.date} - ${s.recipe} x${s.qty} (${s.branch})</li>`).join("");
}

// Daily Report
function buildDaily(){
  let date=qs("#dailyDate").value;
  let sales=state.sales.filter(s=>s.date===date);
  let usage={};
  sales.forEach(s=>{
    let r=state.recipes.find(r=>r.name===s.recipe);
    if(r) r.ing.forEach(i=>usage[i]=(usage[i]||0)+s.qty);
  });
  qs("#dailyTable").innerHTML=Object.entries(usage).map(([i,q])=>`<tr><td>${i}</td><td>${q}</td></tr>`).join("");
  qs("#dailyKPI").innerHTML=`<p>Total Sales: ${sales.length} | Total Qty: ${sales.reduce((a,b)=>a+b.qty,0)}</p>`;
  let ctx=qs("#dailyChart").getContext("2d");
  if(dailyChart) dailyChart.destroy();
  dailyChart=new Chart(ctx,{type:"bar",data:{labels:Object.keys(usage),datasets:[{label:"Usage",data:Object.values(usage)}]}});
}

// Monthly Report
function buildMonthly(){
  let ym=qs("#monthlyDate").value; if(!ym) return;
  let [y,m]=ym.split("-"); let days=[...Array(31).keys()].map(d=>(new Date(y,m-1,d+1).toISOString().slice(0,10))).filter(d=>d.slice(5,7)===m);
  let use={}; state.ingredients.forEach(i=>use[i]={});
  days.forEach(d=>{
    let sales=state.sales.filter(s=>s.date===d);
    sales.forEach(s=>{
      let r=state.recipes.find(r=>r.name===s.recipe);
      if(r) r.ing.forEach(i=>use[i][d]=(use[i][d]||0)+s.qty);
    });
  });
  qs("#monthlyHead").innerHTML="<tr><th>Ingredient</th>"+days.map(d=>"<th>"+d.slice(8)+"</th>").join("")+"<th>Total</th></tr>";
  qs("#monthlyTable").innerHTML=state.ingredients.map(i=>{
    let rowDays=days.map(d=>use[i][d]||0); let tot=rowDays.reduce((a,b)=>a+b,0);
    return "<tr><td>"+i+"</td>"+rowDays.map(v=>"<td>"+v+"</td>").join("")+"<td>"+tot+"</td></tr>";
  }).join("");
  qs("#monthlyKPI").innerHTML=`<p>Total Ingredients: ${state.ingredients.length} | Total Days: ${days.length}</p>`;
  let ctx=qs("#monthlyChart").getContext("2d"); if(monthlyChart) monthlyChart.destroy();
  monthlyChart=new Chart(ctx,{type:"line",data:{labels:days.map(d=>d.slice(8)),datasets:state.ingredients.map(i=>({label:i,data:days.map(d=>use[i][d]||0]}))}});
}

// Export
function exportSales(){
  let rows=["Date,Branch,Recipe,Qty"];
  state.sales.forEach(s=>rows.push([s.date,s.branch,s.recipe,s.qty].join(",")));
  download("sales.csv",rows.join("\n"));
}
function exportMonthly(){
  let table=document.querySelector("#monthlyTable").outerHTML;
  download("monthly_report.csv",table.replace(/<[^>]+>/g,","));
}
function download(filename,text){
  let a=document.createElement("a");
  a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(text);
  a.download=filename; a.click();
}

// Init
renderBranches(); renderRecipes(); renderSales(); renderInventory();
</script>
</body>
</html>
