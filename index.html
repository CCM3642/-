<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crispy Chicken ‚Äì Branch & Recipe System</title>
  <style>
    body {font-family: Arial, sans-serif; margin:0; background:#0b1d3a; color:#eaf1ff;}
    header {background:#d93900; padding:15px; text-align:center; font-size:22px; font-weight:bold;}
    nav {display:flex; background:#12214d;}
    nav button {flex:1; padding:12px; background:#12214d; border:none; color:#fff; cursor:pointer;}
    nav button.active {background:#d93900;}
    section {display:none; padding:20px;}
    table {width:100%; border-collapse:collapse; margin:10px 0;}
    th, td {border:1px solid #345; padding:8px; text-align:center;}
    th {background:#23315b;}
    .kpi {background:#1e2f5c; padding:10px; margin:5px; border-radius:5px; display:inline-block;}
    input, select, button {padding:6px; margin:3px;}
    canvas {background:#12214d; border-radius:5px;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>üçó Crispy Chicken ‚Äì Branch, Recipe & Sales System</header>
<nav>
  <button onclick="show('branches')">Branches</button>
  <button onclick="show('ingredients')">Ingredients</button>
  <button onclick="show('recipes')">Recipes</button>
  <button onclick="show('sales')">Sales</button>
  <button onclick="show('stock')">Stock</button>
  <button onclick="show('monthly')">Monthly Report</button>
</nav>

<!-- Branches -->
<section id="branches">
  <h2>Branches</h2>
  <input id="branchName" placeholder="Branch Name">
  <button onclick="addBranch()">‚ûï Add Branch</button>
  <table><thead><tr><th>ID</th><th>Name</th></tr></thead><tbody id="branchList"></tbody></table>
</section>

<!-- Ingredients -->
<section id="ingredients">
  <h2>Ingredients</h2>
  <input id="ingName" placeholder="Ingredient">
  <button onclick="addIngredient()">‚ûï Add</button>
  <table><thead><tr><th>Name</th></tr></thead><tbody id="ingList"></tbody></table>
</section>

<!-- Recipes -->
<section id="recipes">
  <h2>Recipes</h2>
  <input id="recipeName" placeholder="Recipe">
  <select id="recipeIng"></select>
  <input id="recipeQty" type="number" min="0.1" step="0.1" placeholder="Qty">
  <button onclick="addToRecipe()">‚ûï Add to Recipe</button>
  <button onclick="saveRecipe()">üíæ Save Recipe</button>
  <table><thead><tr><th>Recipe</th><th>Ingredient</th><th>Qty</th></tr></thead><tbody id="recipeList"></tbody></table>
</section>

<!-- Sales -->
<section id="sales">
  <h2>Sales</h2>
  <select id="saleBranch"></select>
  <select id="saleRecipe"></select>
  <input id="saleQty" type="number" min="1" value="1">
  <button onclick="recordSale()">‚ûï Record Sale</button>
  <table><thead><tr><th>Date</th><th>Branch</th><th>Recipe</th><th>Qty</th></tr></thead><tbody id="saleList"></tbody></table>
  <button onclick="exportSales()">‚¨áÔ∏è Export Sales CSV</button>
</section>

<!-- Stock -->
<section id="stock">
  <h2>Stock</h2>
  <select id="stockIng"></select>
  <input id="stockQty" type="number" min="0" placeholder="Qty">
  <button onclick="updateStock()">üíæ Update</button>
  <table><thead><tr><th>Ingredient</th><th>Available</th></tr></thead><tbody id="stockList"></tbody></table>
</section>

<!-- Monthly Report -->
<section id="monthly">
  <h2>üìä Monthly Report</h2>
  <div id="kpis"></div>
  <table><thead><tr id="monthlyHead"></tr></thead><tbody id="monthlyBody"></tbody></table>
  <canvas id="monthlyChart" height="120"></canvas>
  <button onclick="exportMonthly()">‚¨áÔ∏è Export Monthly CSV</button>
</section>

<script>
const qs=id=>document.querySelector(id);
let state={branches:[], ingredients:[], recipes:[], sales:[], stock:{}};
let tempRecipe={}, monthlyChart;

function save(){localStorage.setItem('crispySys',JSON.stringify(state));}
function load(){let d=localStorage.getItem('crispySys'); if(d) state=JSON.parse(d);}
function show(id){document.querySelectorAll('section').forEach(s=>s.style.display='none');qs('#'+id).style.display='block';document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));event.target.classList.add('active'); if(id==='monthly') buildMonthly();}
function render(){
  // Branch
  qs('#branchList').innerHTML=state.branches.map((b,i)=>`<tr><td>${i+1}</td><td>${b}</td></tr>`).join('');
  qs('#saleBranch').innerHTML=state.branches.map(b=>`<option>${b}</option>`).join('');
  // Ing
  qs('#ingList').innerHTML=state.ingredients.map(i=>`<tr><td>${i}</td></tr>`).join('');
  qs('#recipeIng').innerHTML=state.ingredients.map(i=>`<option>${i}</option>`).join('');
  qs('#stockIng').innerHTML=state.ingredients.map(i=>`<option>${i}</option>`).join('');
  // Recipe
  qs('#recipeList').innerHTML=Object.entries(tempRecipe).map(([r,ings])=>ings.map(i=>`<tr><td>${r}</td><td>${i.ing}</td><td>${i.qty}</td></tr>`).join('')).join('');
  qs('#saleRecipe').innerHTML=state.recipes.map(r=>`<option>${r.name}</option>`).join('');
  // Sales
  qs('#saleList').innerHTML=state.sales.map(s=>`<tr><td>${s.date}</td><td>${s.branch}</td><td>${s.recipe}</td><td>${s.qty}</td></tr>`).join('');
  // Stock
  qs('#stockList').innerHTML=Object.entries(state.stock).map(([i,q])=>`<tr><td>${i}</td><td>${q}</td></tr>`).join('');
}
function addBranch(){let v=qs('#branchName').value.trim();if(!v) return;state.branches.push(v);qs('#branchName').value='';save();render();}
function addIngredient(){let v=qs('#ingName').value.trim();if(!v) return;state.ingredients.push(v);state.stock[v]=0;qs('#ingName').value='';save();render();}
function addToRecipe(){let r=qs('#recipeName').value.trim();let i=qs('#recipeIng').value;let q=+qs('#recipeQty').value;if(!r||!i||!q) return;if(!tempRecipe[r]) tempRecipe[r]=[];tempRecipe[r].push({ing:i,qty:q});render();}
function saveRecipe(){for(let [n,ings] of Object.entries(tempRecipe)) state.recipes.push({name:n,ings});tempRecipe={};save();render();}
function recordSale(){let b=qs('#saleBranch').value;let r=qs('#saleRecipe').value;let q=+qs('#saleQty').value;if(!b||!r||!q) return;state.sales.push({branch:b,recipe:r,qty:q,date:new Date().toLocaleString()});let rec=state.recipes.find(x=>x.name===r);rec.ings.forEach(i=>{state.stock[i.ing]=(state.stock[i.ing]||0)-i.qty*q});save();render();}
function updateStock(){let i=qs('#stockIng').value;let q=+qs('#stockQty').value;state.stock[i]=q;save();render();}
function exportSales(){let rows=[["Date","Branch","Recipe","Qty"],...state.sales.map(s=>[s.date,s.branch,s.recipe,s.qty])];let csv=rows.map(r=>r.join(",")).join("\n");let blob=new Blob([csv],{type:"text/csv"});let a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="sales.csv";a.click();}
function exportMonthly(){let rows=[["Day",...state.ingredients,"Total"]];document.querySelectorAll("#monthlyBody tr").forEach(tr=>{rows.push([...tr.children].map(td=>td.textContent));});let csv=rows.map(r=>r.join(",")).join("\n");let blob=new Blob([csv],{type:"text/csv"});let a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="monthly.csv";a.click();}
function buildMonthly(){
  let month=new Date().getMonth();let days=[...Array(31).keys()].map(i=>i+1);
  let use={};state.sales.forEach(s=>{let d=new Date(s.date).getDate();if(new Date(s.date).getMonth()!==month) return;if(!use[d]) use[d]={};let rec=state.recipes.find(r=>r.name===s.recipe);rec.ings.forEach(i=>{use[d][i.ing]=(use[d][i.ing]||0)+i.qty*s.qty;});});
  // Head
  qs('#monthlyHead').innerHTML='<th>Day</th>'+state.ingredients.map(i=>`<th>${i}</th>`).join('')+'<th>Total</th>';
  let totals={};qs('#monthlyBody').innerHTML=days.map(d=>{let row=[d];let sum=0;state.ingredients.forEach(i=>{let v=use[d]?.[i]||0;row.push(v);sum+=v;totals[i]=(totals[i]||0)+v;});row.push(sum);return '<tr>'+row.map(x=>`<td>${x}</td>`).join('')+'</tr>';}).join('');
  qs('#monthlyBody').innerHTML+='<tr><td><b>TOTAL</b></td>'+state.ingredients.map(i=>`<td><b>${totals[i]||0}</b></td>`).join('')+'<td><b>'+Object.values(totals).reduce((a,b)=>a+b,0)+'</b></td></tr>';
  // KPIs
  qs('#kpis').innerHTML=`<div class="kpi">Total Sales: ${state.sales.length}</div><div class="kpi">Total Ingredients Used: ${Object.values(totals).reduce((a,b)=>a+b,0)}</div>`;
  // Chart
  const ctx=qs('#monthlyChart').getContext('2d'); if(monthlyChart) monthlyChart.destroy();
  monthlyChart=new Chart(ctx,{type:'line',data:{labels:days,datasets:state.ingredients.map(i=>({label:i,data:days.map(d=>use[d]?.[i]||0),borderWidth:2,fill:false}))},options:{responsive:true,plugins:{legend:{position:'top',labels:{color:'#eaf1ff'}}},scales:{x:{ticks:{color:'#eaf1ff'},grid:{color:'#23315b'}},y:{ticks:{color:'#eaf1ff'},grid:{color:'#23315b'}}}}});
}
load();render();show('branches');
</script>
</body>
</html>
