<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Compensation Tickets Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/heatmapjs@2.0.5/heatmap.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Floating Dock */
    .dock {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
      z-index: 1000;
      cursor: grab;
    }
    .dock:active {
      cursor: grabbing;
    }
    .dock-buttons {
      display: none;
      flex-direction: column;
      gap: 8px;
      animation: fadeIn 0.3s ease-in-out;
    }
    .dock-buttons.show {
      display: flex;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: none;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 400px;
    }
  </style>
</head>
<body class="bg-gray-50 p-6">

  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800 flex items-center">
      üìë Compensation Tickets
    </h1>
  </div>

  <!-- Tickets Table -->
  <div class="bg-white shadow rounded-lg p-4">
    <table id="ticketsTable" class="min-w-full border-collapse">
      <thead>
        <tr class="text-left text-gray-700 border-b">
          <th class="py-2 px-3">Order ID</th>
          <th class="py-2 px-3">Order Date</th>
          <th class="py-2 px-3">Branch</th>
          <th class="py-2 px-3">Platform</th>
          <th class="py-2 px-3">Issue</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-b">
          <td class="font-bold px-3 py-2">0258</td>
          <td class="px-3 py-2">2025-09-02</td>
          <td class="px-3 py-2">Crispy Chicken Muroor</td>
          <td class="px-3 py-2">Noon</td>
          <td class="px-3 py-2">Incorrect items: Ultimate Spicy x 1, Ultimate Mix</td>
        </tr>
        <tr class="border-b">
          <td class="font-bold px-3 py-2">FF92NNY2JHDG0HA</td>
          <td class="px-3 py-2">2025-09-02</td>
          <td class="px-3 py-2">Crispy Chicken Hamdan</td>
          <td class="px-3 py-2">Noon</td>
          <td class="px-3 py-2">Refund: Missing item (Outlet)</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Charts Section -->
  <div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
    <div class="bg-white p-4 rounded-lg shadow">
      <h2 class="text-lg font-semibold mb-2">Complaints by Branch</h2>
      <canvas id="barChart"></canvas>
    </div>
    <div class="bg-white p-4 rounded-lg shadow">
      <h2 class="text-lg font-semibold mb-2">Issues Breakdown</h2>
      <canvas id="pieChart"></canvas>
    </div>
  </div>

  <!-- Modal for New Ticket -->
  <div id="ticketModal" class="modal">
    <div class="modal-content">
      <h2 class="text-lg font-bold mb-4">‚ûï Add New Ticket</h2>
      <form id="ticketForm" class="space-y-3">
        <input type="text" id="orderId" placeholder="Order ID" class="w-full border px-3 py-2 rounded">
        <input type="date" id="orderDate" class="w-full border px-3 py-2 rounded">
        <input type="text" id="branch" placeholder="Branch" class="w-full border px-3 py-2 rounded">
        <input type="text" id="platform" placeholder="Platform" class="w-full border px-3 py-2 rounded">
        <input type="text" id="issue" placeholder="Issue" class="w-full border px-3 py-2 rounded">
        <div class="flex justify-end gap-2">
          <button type="button" id="cancelModal" class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button>
          <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Add</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Floating Dock -->
  <div id="dock" class="dock">
    <button id="dockToggle" class="bg-gray-800 text-white px-4 py-2 rounded-full shadow">‚öôÔ∏è</button>
    <div id="dockButtons" class="dock-buttons">
      <button id="newTicketBtn" class="bg-red-500 text-white px-4 py-2 rounded shadow">‚ûï New Ticket</button>
      <button id="addSampleBtn" class="bg-red-400 text-white px-4 py-2 rounded shadow">üìå Add Sample</button>
      <button id="resetBtn" class="bg-gray-400 text-white px-4 py-2 rounded shadow">üîÑ Reset</button>
      <button id="printBtn" class="bg-blue-500 text-white px-4 py-2 rounded shadow">üñ®Ô∏è Print</button>
      <button id="dashboardBtn" class="bg-green-500 text-white px-4 py-2 rounded shadow">üìä Dashboard</button>
      <button id="heatmapBtn" class="bg-yellow-500 text-white px-4 py-2 rounded shadow">üî• Heatmap</button>
      <button id="exportBtn" class="bg-indigo-500 text-white px-4 py-2 rounded shadow">üìÇ Export</button>
    </div>
  </div>

  <script>
    const tableBody = document.querySelector("#ticketsTable tbody");

    // Dock Toggle
    document.getElementById("dockToggle").addEventListener("click", () => {
      document.getElementById("dockButtons").classList.toggle("show");
    });

    // Make Dock Draggable
    const dock = document.getElementById("dock");
    let isDragging = false, offsetX, offsetY;
    dock.addEventListener("mousedown", (e) => {
      if (e.target.id === "dockToggle") return;
      isDragging = true;
      offsetX = e.clientX - dock.getBoundingClientRect().left;
      offsetY = e.clientY - dock.getBoundingClientRect().top;
    });
    document.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      dock.style.left = `${e.clientX - offsetX}px`;
      dock.style.top = `${e.clientY - offsetY}px`;
      dock.style.bottom = "auto"; dock.style.right = "auto";
    });
    document.addEventListener("mouseup", () => isDragging = false);

    // Modal Handlers
    const modal = document.getElementById("ticketModal");
    document.getElementById("newTicketBtn").addEventListener("click", () => modal.style.display = "flex");
    document.getElementById("cancelModal").addEventListener("click", () => modal.style.display = "none");
    document.getElementById("ticketForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const row = document.createElement("tr");
      row.classList.add("border-b");
      row.innerHTML = `
        <td class="font-bold px-3 py-2">${orderId.value}</td>
        <td class="px-3 py-2">${orderDate.value}</td>
        <td class="px-3 py-2">${branch.value}</td>
        <td class="px-3 py-2">${platform.value}</td>
        <td class="px-3 py-2">${issue.value}</td>
      `;
      tableBody.appendChild(row);
      modal.style.display = "none";
      e.target.reset();
    });

    // Add Sample Ticket
    document.getElementById("addSampleBtn").addEventListener("click", () => {
      const row = document.createElement("tr");
      row.classList.add("border-b");
      row.innerHTML = `
        <td class="font-bold px-3 py-2">SAMPLE123</td>
        <td class="px-3 py-2">2025-09-02</td>
        <td class="px-3 py-2">Crispy Chicken Al Danah</td>
        <td class="px-3 py-2">Careem</td>
        <td class="px-3 py-2">Late delivery + cold fries</td>
      `;
      tableBody.appendChild(row);
    });

    // Reset Table
    document.getElementById("resetBtn").addEventListener("click", () => {
      tableBody.innerHTML = "";
    });

    // Print
    document.getElementById("printBtn").addEventListener("click", () => window.print());

    // Scroll to Dashboard
    document.getElementById("dashboardBtn").addEventListener("click", () => {
      document.getElementById("dashboard").scrollIntoView({ behavior: "smooth" });
    });

    // Heatmap Toggle
    let heatmapVisible = false;
    const heatmapContainer = document.createElement("div");
    heatmapContainer.style.position = "fixed";
    heatmapContainer.style.top = "0";
    heatmapContainer.style.left = "0";
    heatmapContainer.style.width = "100%";
    heatmapContainer.style.height = "100%";
    heatmapContainer.style.zIndex = "1500";
    document.body.appendChild(heatmapContainer);
    const heatmap = h337.create({ container: heatmapContainer });
    document.getElementById("heatmapBtn").addEventListener("click", () => {
      heatmapVisible = !heatmapVisible;
      heatmapContainer.style.display = heatmapVisible ? "block" : "none";
      if (heatmapVisible) {
        heatmap.setData({
          max: 5,
          data: [
            { x: 200, y: 200, value: 3 },
            { x: 500, y: 300, value: 5 },
            { x: 800, y: 400, value: 4 }
          ]
        });
      }
    });

    // Export CSV
    document.getElementById("exportBtn").addEventListener("click", () => {
      let csv = [];
      document.querySelectorAll("#ticketsTable tr").forEach(row => {
        let rowData = [];
        row.querySelectorAll("th, td").forEach(cell => rowData.push(cell.innerText));
        csv.push(rowData.join(","));
      });
      const blob = new Blob([csv.join("\n")], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "tickets.csv";
      a.click();
    });

    // Bar Chart
    new Chart(document.getElementById("barChart"), {
      type: "bar",
      data: {
        labels: ["Muroor", "Hamdan", "Al Danah"],
        datasets: [{ label: "Complaints", data: [5, 8, 3], backgroundColor: "rgba(239,68,68,0.7)" }]
      }
    });

    // Pie Chart
    new Chart(document.getElementById("pieChart"), {
      type: "pie",
      data: {
        labels: ["Cold Food", "Late Delivery", "Wrong Items", "Missing Items", "Food Quality", "Other"],
        datasets: [{
          data: [10, 15, 5, 8, 12, 4],
          backgroundColor: [
            "rgba(239,68,68,0.7)",
            "rgba(59,130,246,0.7)",
            "rgba(16,185,129,0.7)",
            "rgba(245,158,11,0.7)",
            "rgba(139,92,246,0.7)",
            "rgba(107,114,128,0.7)"
          ]
        }]
      }
    });
  </script>
</body>
</html>
